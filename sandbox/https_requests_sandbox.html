<!DOCTYPE html>
<html>
<head>

</head>
	<meta charset="utf-8">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.js"></script>
	<title>HTTP SANDBOX</title>
</head>

	<body>

		<form action="/" id="searchForm">
			First name:<br>
			<input type="text" id="fn" name="firstname">
			<br>
			Last name:<br>
			<input type="text" id="ln" name="lastname">

			<button type="button" onclick ="find_person()" >Get HTTP Request!</button>
			<br><br>
			User_ID:<br>
			<input type="text" id="IDD" name="ID">
			<br>
			Amount:<br>
			<input type="text" id="amt" name="amount">
			<button type="button" onclick ="make_payment(10, 9, 8, 7, 6)" >Make a Payment!</button>

		</form>

	</body>


</html>

<script>
	var a;
	var fname;
	var lname;
	var id;

	find_person = function(){


		//Finds users based off of name put in the box and gets their ID
		$.get( "http://api.reimaginebanking.com/customers/?key=ENT0a1ef41ece34435feeffd062b38dd917", function( data ) {
		  var x = 0;
		  while (x < data.length) {
		  	var entry = data[x];
		  	//alert(document.getElementById("fn").value)
		  	if ((document.getElementById("fn").value === data[x].first_name) && (document.getElementById("ln").value === data[x].last_name)){
		  		id = data[x]._id;
		  		break;
		  	} else {
		  		//alert("ERROR: USER NOT FOUND!")
		  	}
		  	//console.log(entry);
			x++;
		  }
		  alert( "Load was performed." );
		  find_acct(id)	  

		});
	
	}

	find_acct = function(id){
	//Finds accounts and balances
		var balance;
		var url_acct = "http://api.reimaginebanking.com/customers/" + id + "/accounts/?key=ENT0a1ef41ece34435feeffd062b38dd917";
		$.get(url_acct, function( data ) {
			var x = 0;
			while (x < data.length) {
				var entry = data[x];
				/* balance = balance + entry.balance;*/
				id = entry.customer;
				x++;
				break;
			}

			if (entry.balance <= 1000){
				find_bills(0, id)
			} else if ((entry.balance <= 10000) && (entry.balance > 1000)) {
				find_bills(10, id)
			} else if ((entry.balance <= 100000) && (entry.balance > 10000)) {
				find_bills(20, id)
			} else if ((entry.balance <= 1000000) && (entry.balance > 100000)) {
				find_bills(30, id)
			} else if ((entry.balance <= 10000000) && (entry.balance > 1000000)) {
				find_bills(40, id)
			} else  {
				find_bills(50, id)
			}
		});	
		
	}

	//Finds bills and debts
	find_bills = function(score, id){
		var debt;

			var url_acct = "http://api.reimaginebanking.com/customers/" + id + "/bills/?key=ENT0a1ef41ece34435feeffd062b38dd917";
			$.get(url_acct, function( data ) {
				var x = 0;
				while (x < data.length) {
					var entry = data[x];
					/* debt += data[x].payment_amount;*/
					debt = entry.payment_amount
					x++;
				}

				if (data.length == 0){
					debt = 0;
				}

				if (debt <= 1000){
					find_history(score-0, id)
				} else if ((debt <= 10000) && (debt > 1000)) {
					find_history(score-10, id)
				} else if ((debt <= 100000) && (debt > 10000)) {
					find_history(score-20, id)
				} else if ((debt <= 1000000) && (debt > 100000)) {
					find_history(score-30, id)
				} else if ((debt <= 10000000) && (debt > 1000000)) {
					find_history(score-40, id)
				} else  {
					find_history(score-50, id)
				}
			});	
	}

	find_history = function(score, id){
		alert(id + " has score of: " + score);
	}

	//ID of account the transction is for
	make_payment = function(transaction_id, payment_amount, payer_id, payee_id, account_into_id){
		
		//var $form = $( this ),
	    //term = document.getElementById("amt").value,
	    //url = $form.attr( "action" );
	    
	    url = "http://api.reimaginebanking.com/accounts/" + "5516c07ba520e0066c9ac6ec" + "/transactions/?key=CUST0a1ef41ece34435feeffd062b38dd917";

		var dataObj = JSON.stringify({"transaction_type": "cash",  "payee_id": "5516c07ba520e0066c9aca3d",  "amount": payment_amount});
		console.log(dataObj);
			$.ajax({	
				
			  	type: "POST",
			  	url:  "http://api.reimaginebanking.com/accounts/" + "5516c07ba520e0066c9ac6ec" + "/transactions/?key=CUST0a1ef41ece34435feeffd062b38dd917",
			  	data:  dataObj,
	    		contentType: 'application/json',
			  	success: function(data, textStatus, jqXHR)
			    {
			    	console.log("SUCCESS");
			        console.log(data);
			    },
			    error: function (jqXHR, textStatus, errorThrown)
			    {
			 		console.log("ERROR");
			 		console.log(errorThrown);
			 		console.log(jqXHR.responseText);
			 		console.log(textStatus)
			    }
		});

		/*	var url_acct = "http://api.reimaginebanking.com/customers/" + "5516c07ba520e0066c9aca3d" + "/bills/?key=ENT0a1ef41ece34435feeffd062b38dd917";


			$.post( url_acct, { payee_id: "546cd56d04783a02616859c9", amount: "20" })
			  .done(function( data ) {
			    alert( "Data Loaded: " + data );
			 }); */

	}
/*
	10 1000 - 10,000
	20 10,000 - 100,000
	30 100,000 - 1,000,000
	40 10,000,000 - 1,000,000,000
	50 1,000,000,000 <  

	-10 1000 - 10,000
	-20 10,000 - 100,000
	-30 100,000 - 1,000,000
	-40 10,000,000 - 1,000,000,000
	-50 1,000,000,000 <

	(50 * loans repayed) - (50 * payments missed ) + ()
	//Credit score depends on number of succesful loans repayed, number of payments missed, amount of money in the bank, amount borrowed 
	//Insert User info -> Find User -> Find accounts -> Go through each accont 




			/*
		 $.ajax({
		  'type' : 'GET',
		  'url': 'http://api.reimaginebanking.com/customers?key=ENT0a1ef41ece34435feeffd062b38dd917',
		  'data': JSON.stringify({ _id: _id, first_name: first_name, last_name: last_name}), 
		  'contentType': "application/json;charset=UTF-8",
		  'success' : function(data) {
			alert("cool")
			alert(JSON.parse(data))
		  }, 'error' : function (data){
			alert("lols")
		  }
		});   */

	   // Send the data using post
	   /*
		  console.log("1")
		  var response = $.post( url, {transaction_type: "cash",  payee_id: "5516c07ba520e0066c9aca3d",  amount: 10});
		  console.log(response)
		  console.log(url)
		   /*/
	  
	  /*
		  $.ajax({
		    url : "http://api.reimaginebanking.com/accounts/" + "5516c07ba520e0066c9ac6ec" + "/transactions/?key=CUST0a1ef41ece34435feeffd062b38dd917",
		    type: "POST",
		    data : {"transaction_type": "cash",  "payee_id": "5516c07ba520e0066c9aca3d",  "amount": 10},
		    contentType : "application/json;charset=UTF-8",
		    dataType: 'jsonp',
		    crossDomain: true,
		    success: function(data, textStatus, jqXHR)
		    {
		        //data - response from server
		        console.log("yes")
		    },
		    error: function (jqXHR, textStatus, errorThrown)
		    {
		 		console.log(errorThrown)
		    }
		}); */
	
</script>

